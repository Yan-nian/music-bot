<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Bot - é…ç½®ä¸­å¿ƒ</title>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f5f5f7;
            --card-bg: rgba(255, 255, 255, 0.8);
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --accent: #007AFF;
            --accent-hover: #0056b3;
            --success: #34c759;
            --warning: #ff9500;
            --danger: #ff3b30;
            --border: rgba(0, 0, 0, 0.1);
            --shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* å¤´éƒ¨ */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: var(--card-bg);
            border-radius: 20px;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow);
            position: relative;
        }

        .header-actions {
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            gap: 8px;
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .header-btn:hover {
            background: var(--accent);
            transform: scale(1.05);
        }

        .header-btn-danger:hover {
            background: var(--danger);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent), #5856d6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* çŠ¶æ€å¡ç‰‡ */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }

        .status-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: transform 0.2s ease;
        }

        .status-card:hover {
            transform: translateY(-2px);
        }

        .status-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .status-icon.enabled {
            background: rgba(52, 199, 89, 0.15);
            color: var(--success);
        }

        .status-icon.disabled {
            background: rgba(134, 134, 139, 0.15);
            color: var(--text-secondary);
        }

        .status-info h3 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .status-info span {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* å¯¼èˆªæ ‡ç­¾ */
        .nav-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 24px;
            background: var(--card-bg);
            border: none;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(20px);
        }

        .nav-tab:hover {
            background: rgba(0, 122, 255, 0.1);
            color: var(--accent);
        }

        .nav-tab.active {
            background: var(--accent);
            color: white;
        }

        /* é…ç½®åŒºåŸŸ */
        .config-section {
            display: none;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .config-section.active {
            display: block;
        }

        .config-section h2 {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-group {
            margin-bottom: 24px;
        }

        .config-group h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .form-group input[type="text"],
        .form-group input[type="password"],
        .form-group input[type="number"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            font-size: 0.95rem;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.5);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.15);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* å¼€å…³ */
        .switch-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .switch-label {
            font-weight: 500;
        }

        .switch {
            position: relative;
            width: 52px;
            height: 32px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 32px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input:checked + .slider {
            background-color: var(--accent);
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* æŒ‰é’® */
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            font-size: 0.95rem;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #d62c23;
        }

        /* Toast é€šçŸ¥ */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.info {
            background: var(--accent);
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .config-section {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <div class="header-actions">
                <a href="/playlists" class="header-btn" title="æ­Œå•è®¢é˜…">ğŸ“‹</a>
                <a href="/account" class="header-btn" title="è´¦å·ç®¡ç†">ğŸ‘¤</a>
                <a href="/logout" class="header-btn header-btn-danger" title="é€€å‡ºç™»å½•">ğŸšª</a>
            </div>
            <h1>ğŸµ Music Bot é…ç½®ä¸­å¿ƒ</h1>
            <p>ç®¡ç†ä½ çš„éŸ³ä¹ä¸‹è½½æœºå™¨äººé…ç½®</p>
        </div>

        <!-- çŠ¶æ€å¡ç‰‡ -->
        <div class="status-grid" id="statusGrid">
            <div class="status-card">
                <div class="status-icon disabled" id="statusBot">ğŸ¤–</div>
                <div class="status-info">
                    <h3>Telegram Bot</h3>
                    <span id="statusBotText">æœªé…ç½®</span>
                </div>
            </div>
            <div class="status-card">
                <div class="status-icon disabled" id="statusNetease">ğŸµ</div>
                <div class="status-info">
                    <h3>ç½‘æ˜“äº‘éŸ³ä¹</h3>
                    <span id="statusNeteaseText">æœªå¯ç”¨</span>
                </div>
            </div>
            <div class="status-card">
                <div class="status-icon disabled" id="statusApple">ğŸ</div>
                <div class="status-info">
                    <h3>Apple Music</h3>
                    <span id="statusAppleText">æœªå¯ç”¨</span>
                </div>
            </div>
            <div class="status-card">
                <div class="status-icon disabled" id="statusYoutube">â–¶ï¸</div>
                <div class="status-info">
                    <h3>YouTube Music</h3>
                    <span id="statusYoutubeText">æœªå¯ç”¨</span>
                </div>
            </div>
        </div>

        <!-- å¯¼èˆªæ ‡ç­¾ -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-section="telegram">ğŸ“± Telegram</button>
            <button class="nav-tab" data-section="netease">ğŸµ ç½‘æ˜“äº‘éŸ³ä¹</button>
            <button class="nav-tab" data-section="apple">ğŸ Apple Music</button>
            <button class="nav-tab" data-section="youtube">â–¶ï¸ YouTube Music</button>
            <button class="nav-tab" data-section="general">âš™ï¸ é€šç”¨è®¾ç½®</button>
        </div>

        <!-- Telegram é…ç½® -->
        <div class="config-section active" id="section-telegram">
            <h2>ğŸ“± Telegram é…ç½®</h2>
            
            <div class="config-group">
                <h3>Bot è®¾ç½®</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Bot Token *</label>
                        <input type="password" id="telegram_bot_token" placeholder="ä» @BotFather è·å–">
                    </div>
                    <div class="form-group">
                        <label>å…è®¸çš„ç”¨æˆ· ID</label>
                        <input type="text" id="telegram_allowed_users" placeholder="å¤šä¸ªç”¨é€—å·åˆ†éš”ï¼Œç•™ç©ºå…è®¸æ‰€æœ‰äºº">
                    </div>
                </div>
            </div>

            <div class="config-group">
                <h3>API è®¾ç½®ï¼ˆå¯é€‰ï¼Œç”¨äºä¸‹è½½å¤§æ–‡ä»¶ï¼‰</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>API ID</label>
                        <input type="text" id="telegram_api_id" placeholder="ä» my.telegram.org è·å–">
                    </div>
                    <div class="form-group">
                        <label>API Hash</label>
                        <input type="password" id="telegram_api_hash" placeholder="ä» my.telegram.org è·å–">
                    </div>
                </div>
                <div class="form-group">
                    <label>Session String</label>
                    <textarea id="telegram_session_string" placeholder="é€šè¿‡ /setup é¡µé¢ç”Ÿæˆ"></textarea>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveConfig('telegram')">ğŸ’¾ ä¿å­˜é…ç½®</button>
                <a href="/setup" class="btn btn-secondary">ğŸ” ç”Ÿæˆ Session</a>
            </div>
        </div>

        <!-- ç½‘æ˜“äº‘éŸ³ä¹é…ç½® -->
        <div class="config-section" id="section-netease">
            <h2>ğŸµ ç½‘æ˜“äº‘éŸ³ä¹é…ç½®</h2>
            
            <div class="switch-group">
                <span class="switch-label">å¯ç”¨ç½‘æ˜“äº‘éŸ³ä¹ä¸‹è½½</span>
                <label class="switch">
                    <input type="checkbox" id="netease_enabled">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="config-group">
                <h3>å­˜å‚¨è®¾ç½®</h3>
                <div class="form-group">
                    <label>ä¸‹è½½ä¿å­˜è·¯å¾„</label>
                    <input type="text" id="netease_download_path" placeholder="/downloads/netease">
                </div>
            </div>

            <div class="config-group">
                <h3>ä¸‹è½½è®¾ç½®</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>éŸ³è´¨</label>
                        <select id="netease_quality">
                            <option value="æ ‡å‡†">æ ‡å‡† (128kbps)</option>
                            <option value="è¾ƒé«˜">è¾ƒé«˜ (320kbps)</option>
                            <option value="æé«˜">æé«˜ (FLAC)</option>
                            <option value="æ— æŸ">æ— æŸ (Hi-Res)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ­Œæ›²æ–‡ä»¶åæ ¼å¼</label>
                        <input type="text" id="netease_song_file_format" placeholder="{SongName}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ç›®å½•æ ¼å¼</label>
                        <input type="text" id="netease_dir_format" placeholder="{ArtistName}/{AlbumName}">
                    </div>
                    <div class="form-group">
                        <label>ä¸“è¾‘æ–‡ä»¶å¤¹æ ¼å¼</label>
                        <input type="text" id="netease_album_folder_format" placeholder="{AlbumName}({ReleaseDate})">
                    </div>
                </div>
            </div>

            <div class="config-group">
                <h3>åŠŸèƒ½å¼€å…³</h3>
                <div class="switch-group">
                    <span class="switch-label">ä¸‹è½½æ­Œè¯</span>
                    <label class="switch">
                        <input type="checkbox" id="netease_download_lyrics">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="switch-group">
                    <span class="switch-label">ä¸‹è½½å°é¢</span>
                    <label class="switch">
                        <input type="checkbox" id="netease_download_cover">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="switch-group">
                    <span class="switch-label">åˆå¹¶æ­Œè¯åˆ°éŸ³é¢‘æ–‡ä»¶</span>
                    <label class="switch">
                        <input type="checkbox" id="netease_lyrics_merge">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="config-group">
                <h3>Cookiesï¼ˆéœ€è¦ä¼šå‘˜ä¸‹è½½é«˜å“è´¨ï¼‰</h3>
                <div class="form-group">
                    <label>ç½‘æ˜“äº‘éŸ³ä¹ Cookies</label>
                    <textarea id="netease_cookies" placeholder="MUSIC_U=xxx; __csrf=xxx;"></textarea>
                </div>
            </div>



            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveConfig('netease')">ğŸ’¾ ä¿å­˜é…ç½®</button>
            </div>
        </div>

        <!-- Apple Music é…ç½® -->
        <div class="config-section" id="section-apple">
            <h2>ğŸ Apple Music é…ç½®</h2>
            
            <div class="switch-group">
                <span class="switch-label">å¯ç”¨ Apple Music ä¸‹è½½</span>
                <label class="switch">
                    <input type="checkbox" id="apple_music_enabled">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="config-group">
                <h3>å­˜å‚¨è®¾ç½®</h3>
                <div class="form-group">
                    <label>ä¸‹è½½ä¿å­˜è·¯å¾„</label>
                    <input type="text" id="apple_music_download_path" placeholder="/downloads/apple_music">
                </div>
            </div>

            <div class="config-group">
                <h3>ä¸‹è½½è®¾ç½®</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>éŸ³è´¨</label>
                        <select id="apple_music_quality">
                            <option value="aac">AAC (256kbps)</option>
                            <option value="lossless">æ— æŸ (ALAC)</option>
                            <option value="atmos">æœæ¯”å…¨æ™¯å£°</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>åœ°åŒº</label>
                        <select id="apple_music_region">
                            <option value="cn">ä¸­å›½</option>
                            <option value="us">ç¾å›½</option>
                            <option value="jp">æ—¥æœ¬</option>
                            <option value="hk">é¦™æ¸¯</option>
                            <option value="tw">å°æ¹¾</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="config-group">
                <h3>è§£å¯†æœåŠ¡ï¼ˆé«˜çº§ï¼‰</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>è§£å¯†æœåŠ¡åœ°å€</label>
                        <input type="text" id="apple_music_decrypt_host" placeholder="192.168.2.134:10020">
                    </div>
                    <div class="form-group">
                        <label>è·å–æœåŠ¡åœ°å€</label>
                        <input type="text" id="apple_music_get_host" placeholder="192.168.2.134:20020">
                    </div>
                </div>
            </div>

            <div class="config-group">
                <h3>åŠŸèƒ½å¼€å…³</h3>
                <div class="switch-group">
                    <span class="switch-label">ä¸‹è½½æ­Œè¯</span>
                    <label class="switch">
                        <input type="checkbox" id="apple_music_download_lyrics">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="switch-group">
                    <span class="switch-label">ä¸‹è½½å°é¢</span>
                    <label class="switch">
                        <input type="checkbox" id="apple_music_download_cover">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="config-group">
                <h3>Cookies é…ç½®</h3>
                <div class="form-group">
                    <label>Apple Music Cookies</label>
                    <textarea id="apple_music_cookies" placeholder="ä» music.apple.com å¯¼å‡ºçš„ cookiesï¼ˆNetscape æ ¼å¼æˆ– JSON æ ¼å¼ï¼‰" rows="6"></textarea>
                    <small style="color: var(--text-secondary); margin-top: 8px; display: block;">
                        ğŸ’¡ ä½¿ç”¨æµè§ˆå™¨æ‰©å±• "Get cookies.txt LOCALLY" å¯¼å‡º cookies
                    </small>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveConfig('apple')">ğŸ’¾ ä¿å­˜é…ç½®</button>
            </div>
        </div>

        <!-- YouTube Music é…ç½® -->
        <div class="config-section" id="section-youtube">
            <h2>â–¶ï¸ YouTube Music é…ç½®</h2>
            
            <div class="switch-group">
                <span class="switch-label">å¯ç”¨ YouTube Music ä¸‹è½½</span>
                <label class="switch">
                    <input type="checkbox" id="youtube_music_enabled">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="config-group">
                <h3>å­˜å‚¨è®¾ç½®</h3>
                <div class="form-group">
                    <label>ä¸‹è½½ä¿å­˜è·¯å¾„</label>
                    <input type="text" id="youtube_music_download_path" placeholder="/downloads/youtube_music">
                </div>
            </div>

            <div class="config-group">
                <h3>ä¸‹è½½è®¾ç½®</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>éŸ³è´¨</label>
                        <select id="youtube_music_quality">
                            <option value="best">æœ€ä½³</option>
                            <option value="320k">320kbps</option>
                            <option value="256k">256kbps</option>
                            <option value="128k">128kbps</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è¾“å‡ºæ ¼å¼</label>
                        <select id="youtube_music_format">
                            <option value="m4a">M4A</option>
                            <option value="mp3">MP3</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="config-group">
                <h3>åŠŸèƒ½å¼€å…³</h3>
                <div class="switch-group">
                    <span class="switch-label">ä¸‹è½½å°é¢</span>
                    <label class="switch">
                        <input type="checkbox" id="youtube_music_download_cover">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="config-group">
                <h3>Cookies é…ç½®</h3>
                <div class="form-group">
                    <label>YouTube Cookies</label>
                    <textarea id="youtube_music_cookies" placeholder="ä» youtube.com æˆ– music.youtube.com å¯¼å‡ºçš„ cookiesï¼ˆNetscape æ ¼å¼ï¼‰" rows="6"></textarea>
                    <small style="color: var(--text-secondary); margin-top: 8px; display: block;">
                        ğŸ’¡ ä½¿ç”¨æµè§ˆå™¨æ‰©å±• "Get cookies.txt LOCALLY" å¯¼å‡º cookiesï¼Œç”¨äºä¸‹è½½ä¼šå‘˜ä¸“å±å†…å®¹
                    </small>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveConfig('youtube')">ğŸ’¾ ä¿å­˜é…ç½®</button>
            </div>
        </div>

        <!-- é€šç”¨è®¾ç½® -->
        <div class="config-section" id="section-general">
            <h2>âš™ï¸ é€šç”¨è®¾ç½®</h2>
            
            <div class="config-group">
                <h3>å­˜å‚¨è®¾ç½®</h3>
                <div class="form-group">
                    <label>é»˜è®¤ä¸‹è½½ä¿å­˜è·¯å¾„ï¼ˆæ¯ä¸ªå¹³å°å¯å•ç‹¬è®¾ç½®ï¼‰</label>
                    <input type="text" id="download_path" placeholder="/downloads">
                </div>
                <div class="switch-group">
                    <span class="switch-label">å‘é€åˆ° Telegramï¼ˆå…³é—­åˆ™ä»…ä¿å­˜åˆ°æœ¬åœ°ï¼‰</span>
                    <label class="switch">
                        <input type="checkbox" id="send_to_telegram">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="config-group">
                <h3>ä»£ç†è®¾ç½®</h3>
                <div class="switch-group">
                    <span class="switch-label">å¯ç”¨ä»£ç†</span>
                    <label class="switch">
                        <input type="checkbox" id="proxy_enabled">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="form-group">
                    <label>ä»£ç†åœ°å€</label>
                    <input type="text" id="proxy_host" placeholder="http://192.168.1.1:7890">
                </div>
            </div>

            <div class="config-group">
                <h3>æ—¥å¿—è®¾ç½®</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>æ—¥å¿—çº§åˆ«</label>
                        <select id="log_level">
                            <option value="DEBUG">DEBUG</option>
                            <option value="INFO">INFO</option>
                            <option value="WARNING">WARNING</option>
                            <option value="ERROR">ERROR</option>
                        </select>
                    </div>
                </div>
                <div class="switch-group">
                    <span class="switch-label">è¾“å‡ºåˆ°æ–‡ä»¶</span>
                    <label class="switch">
                        <input type="checkbox" id="log_to_file">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="switch-group">
                    <span class="switch-label">è¾“å‡ºåˆ°æ§åˆ¶å°</span>
                    <label class="switch">
                        <input type="checkbox" id="log_to_console">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveAllConfig()">ğŸ’¾ ä¿å­˜å…¨éƒ¨é…ç½®</button>
                <button class="btn btn-danger" onclick="resetConfig()">ğŸ”„ é‡ç½®ä¸ºé»˜è®¤</button>
            </div>
        </div>
    </div>

    <!-- Toast é€šçŸ¥ -->
    <div class="toast" id="toast"></div>

    <script>
        // åˆå§‹åŒ– Feather Icons
        feather.replace();

        // é…ç½®å­—æ®µæ˜ å°„
        const configFields = {
            telegram: ['telegram_bot_token', 'telegram_allowed_users', 'telegram_api_id', 'telegram_api_hash', 'telegram_session_string'],
            netease: ['netease_enabled', 'netease_download_path', 'netease_quality', 'netease_song_file_format', 'netease_dir_format', 'netease_album_folder_format', 'netease_download_lyrics', 'netease_download_cover', 'netease_lyrics_merge', 'netease_cookies'],
            apple: ['apple_music_enabled', 'apple_music_download_path', 'apple_music_quality', 'apple_music_region', 'apple_music_decrypt_host', 'apple_music_get_host', 'apple_music_download_lyrics', 'apple_music_download_cover', 'apple_music_cookies'],
            youtube: ['youtube_music_enabled', 'youtube_music_download_path', 'youtube_music_quality', 'youtube_music_format', 'youtube_music_download_cover', 'youtube_music_cookies'],
            general: ['download_path', 'send_to_telegram', 'proxy_enabled', 'proxy_host', 'log_level', 'log_to_file', 'log_to_console']
        };

        // æ˜¾ç¤º Toast é€šçŸ¥
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.config-section').forEach(s => s.classList.remove('active'));
                
                tab.classList.add('active');
                const section = document.getElementById(`section-${tab.dataset.section}`);
                if (section) section.classList.add('active');
            });
        });

        // å…¨å±€è¯·æ±‚å¤„ç†ï¼šå¦‚æœè¿”å›401ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
        async function fetchWithAuth(url, options = {}) {
            const response = await fetch(url, options);
            if (response.status === 401) {
                window.location.href = '/login';
                throw new Error('æœªç™»å½•');
            }
            return response;
        }

        // åŠ è½½é…ç½®
        async function loadConfig() {
            try {
                const response = await fetchWithAuth('/api/config');
                const result = await response.json();
                
                if (result.success) {
                    const config = result.data;
                    
                    // å¡«å……æ‰€æœ‰å­—æ®µ
                    Object.keys(config).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            if (element.type === 'checkbox') {
                                element.checked = config[key];
                            } else {
                                element.value = config[key];
                            }
                        }
                    });
                    
                    // æ›´æ–°çŠ¶æ€
                    updateStatus(config);
                }
            } catch (error) {
                console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                showToast('åŠ è½½é…ç½®å¤±è´¥', 'error');
            }
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(config) {
            // Bot çŠ¶æ€
            const botConfigured = config.telegram_bot_token && config.telegram_bot_token !== '******';
            document.getElementById('statusBot').className = `status-icon ${botConfigured ? 'enabled' : 'disabled'}`;
            document.getElementById('statusBotText').textContent = botConfigured ? 'å·²é…ç½®' : 'æœªé…ç½®';

            // ç½‘æ˜“äº‘çŠ¶æ€
            const neteaseEnabled = config.netease_enabled;
            document.getElementById('statusNetease').className = `status-icon ${neteaseEnabled ? 'enabled' : 'disabled'}`;
            document.getElementById('statusNeteaseText').textContent = neteaseEnabled ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨';

            // Apple Music çŠ¶æ€
            const appleEnabled = config.apple_music_enabled;
            document.getElementById('statusApple').className = `status-icon ${appleEnabled ? 'enabled' : 'disabled'}`;
            document.getElementById('statusAppleText').textContent = appleEnabled ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨';

            // YouTube Music çŠ¶æ€
            const youtubeEnabled = config.youtube_music_enabled;
            document.getElementById('statusYoutube').className = `status-icon ${youtubeEnabled ? 'enabled' : 'disabled'}`;
            document.getElementById('statusYoutubeText').textContent = youtubeEnabled ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨';
        }

        // è·å–è¡¨å•æ•°æ®
        function getFormData(section) {
            const fields = configFields[section] || [];
            const data = {};
            
            fields.forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.type === 'checkbox') {
                        data[key] = element.checked;
                    } else {
                        data[key] = element.value;
                    }
                }
            });
            
            return data;
        }

        // ä¿å­˜é…ç½®
        async function saveConfig(section) {
            try {
                const data = getFormData(section);
                
                const response = await fetchWithAuth('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('é…ç½®ä¿å­˜æˆåŠŸ', 'success');
                    loadConfig();  // é‡æ–°åŠ è½½ä»¥æ›´æ–°çŠ¶æ€
                } else {
                    showToast(result.error || 'ä¿å­˜å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                showToast('ä¿å­˜é…ç½®å¤±è´¥', 'error');
            }
        }

        // ä¿å­˜æ‰€æœ‰é…ç½®
        async function saveAllConfig() {
            try {
                const allData = {};
                Object.keys(configFields).forEach(section => {
                    Object.assign(allData, getFormData(section));
                });
                
                const response = await fetchWithAuth('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(allData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('æ‰€æœ‰é…ç½®ä¿å­˜æˆåŠŸ', 'success');
                    loadConfig();
                } else {
                    showToast(result.error || 'ä¿å­˜å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                showToast('ä¿å­˜é…ç½®å¤±è´¥', 'error');
            }
        }

        // é‡ç½®é…ç½®
        async function resetConfig() {
            if (!confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®ä¸ºé»˜è®¤å€¼å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                return;
            }
            
            try {
                const response = await fetchWithAuth('/api/config/reset', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('é…ç½®å·²é‡ç½®', 'success');
                    loadConfig();
                } else {
                    showToast(result.error || 'é‡ç½®å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('é‡ç½®é…ç½®å¤±è´¥:', error);
                showToast('é‡ç½®é…ç½®å¤±è´¥', 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è·å–é…ç½®
        document.addEventListener('DOMContentLoaded', loadConfig);
    </script>
</body>
</html>
